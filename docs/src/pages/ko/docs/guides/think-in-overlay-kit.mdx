# overlay-kit으로 생각하기

React의 철학을 바탕으로한 overlay-kit의 탄생 배경과 이를 구체화한 **Declarative Overlay Pattern**에 대해 알아보겠습니다.

## overlay-kit을 사용하는 이유

### 기존 오버레이 관리의 문제점

1. **상태 관리의 복잡성**

   `useState` 또는 전역 상태를 통해 오버레이의 상태를 직접 관리해야 했습니다.
   상태와 UI 로직이 섞여 있어 코드가 복잡해지고 가독성이 떨어집니다.

2. **이벤트 핸들링의 반복**

   열기, 닫기, 결과 반환 등의 이벤트 핸들링이 반복적으로 작성되어야 했습니다.
   이는 중복 코드를 유발하고 개발 경험을 저하시키는 원인이 되었습니다.

3. **재사용성 부족**

   오버레이에서 값을 반환하는 경우, callback 등의 오버레이 로직과 UI가 강하게 결합되어 재사용이 어렵습니다.

### overlay-kit의 목표

1. **React 철학을 채택**

   React는 선언적인 코드를 작성하는 것을 추구합니다.
   오버레이를 작성할 때 보다 더 선언적인 코드를 작성할 수 있도록 합니다.

2. **개발 생산성 향산**

   상태 관리와 이벤트 핸들링을 캡슐화하여, 개발자가 UI와 비즈니스 로직에만 집중할 수 있도록 합니다.

3. **확장성과 재사용성 강화**

   UI와 동작을 분리하고 Promise를 반환하는 등의 동작을 통해 오버레이의 재사용성을 높입니다.

## Declarative Overlay Pattern

기존의 오버레이 관리 방식은 **명령형(Imperative)** 접근에 의존합니다.
`useState`와 같은 상태 관리 로직과 이벤트 핸들링이 섞여 있어 코드가 복잡하고 가독성이 떨어집니다.

**Declarative Overlay Pattern**은 오버레이를 **상태가 아닌 동작(Behavior)** 중심으로 관리함으로서 더욱 선언적인 코드를 작성할 수 있습니다.

#### 명령형 접근 방식

상태 관리 코드와 이벤트 핸들링 로직이 중복되며, UI와 상태가 강하게 결합되어 있습니다.

```tsx
import { useState } from 'react';

function Overlay() {
  const [isOpen, setIsOpen] = useState(false);

  function handleOpen() {
    setIsOpen(true);
  }

  function handleClose() {
    setIsOpen(false);
  }

  return (
    <>
      <Button onClick={handleOpen}>열기</Button>
      <Dialog open={isOpen} onClose={handleClose}>
        <DialogTitle>명령형 오버레이</DialogTitle>
        <DialogActions>
          <Button onClick={handleClose}>확인</Button>
          <Button onClick={handleClose}>취소</Button>
        </DialogActions>
      </Dialog>
    </>
  );
}
```

#### 선언적 접근 방식

상태 관리 코드가 제거되고, UI와 동작을 명확하게 분리하여 가독성과 유지보수성이 향상됩니다.

```tsx
import { overlay } from 'overlay-kit';

function Overlay() {
  return (
    <Button
      onClick={() => {
        overlay.open(({ isOpen, close }) => (
          <Dialog open={isOpen} onClose={close}>
            <DialogTitle>선언적 오버레이</DialogTitle>
            <DialogActions>
              <Button onClick={close}>확인</Button>
              <Button onClick={close}>취소</Button>
            </DialogActions>
          </Dialog>
        ));
      }}
    >
      열기
    </Button>
  );
}
```

## 핵심 원칙

overlay-kit이 무엇을 추구하는지 이해하려면 overlay-kit의 원칙을 이해할 필요가 있습니다.

### 코로케이션(Co-location)

overlay-kit은 연관되는 코드를 가까이 두는 것을 추구합니다.

오버레이를 호출하는 컴포넌트와 오버레이 상태를 관리하는 코드 그리고 오버레이 컴포넌트 코드를 가까이 두어서 코드를 한눈에 이해할 수 있도록 합니다.

### 최소한의 API

overlay-kit는 가능한 작게 유지하여 배우기 쉽게 만드는 것이 목표입니다. 따라서 overlay-kit은 너무 많은 API를 제공하고 싶지 않습니다.
범용적인 JavaScript 패턴을 바탕으로 가능한 범용적인 API를 작게 제공하려 합니다.

overlay-kit의 핵심 기능은 두 가지로 요약될 수 있습니다:

1. `overlay.open`
2. `overlay.openAsync`

`overlay.open`은 단순히 오버레이를 열고 닫는 기능을 제공하며,
`overlay.openAsync`는 값을 반환하여 비동기 로직을 처리할 수 있도록 합니다.

overlay-kit은 JavaScript 패턴을 이용하여 다양한 오버레이를 구현하는 것을 목표로 합니다.
예를 들어, `overlay.openAsync`는 Promise 값을 반환함으로서 Promise를 활용하는 다양한 패턴을 적용할 수 있습니다.
